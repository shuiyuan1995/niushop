<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>{:lang('choose_payment_method')}-{$title}</title>
    <link rel="stylesheet" type="text/css" href="__TEMP__/{$style}/public/css/pro-detail.css">
    <link rel="stylesheet" type="text/css" href="__TEMP__/{$style}/public/css/member_address.css">
    <link type="text/css" rel="stylesheet" href="__TEMP__/{$style}/public/css/pay/pcPayValue.css">
    <style>
        #month{
            width: 10%;
            text-align: center;
            padding-left: 10px;
        }
        #year{
            width: 16%;
            text-align: center;
            padding-left: 12px;
        }
    </style>
    <link rel="stylesheet" href="__TEMP__/{$style}/public/css/layer.css" id="layuicss-skinlayercss">
</head>
<body class="body-gray" style="margin:auto;">
	<section class="head">
		<a class="head_back" href="javascript:window.history.go(-1)"><i class="icon-back"></i></a>
		<div class="head-title">信息填写</div>
	</section>
<!-- 订单支付内容区域 -->
    <form class="form-info" action="APP_MAIN/pay/credit_card_info" method="post" onsubmit="return checkForm()">
        <div class="div-item">
            <span>选择信用卡</span>
            <select  name="ckind" id="cart_type">
                <option value="Visa" data-account-type-name="Visa">Visa</option>
                <option value="Master card" data-account-type-name="Master card">Master card</option>
                <option value="Discover" data-account-type-name="Discover">Discover</option>
                <option value="Amex" data-account-type-name="Amex">Amex</option>
            </select>
        </div>
        <div class="div-item">
            <span>持卡人姓名</span>
            <input type="text" placeholder="{:lang('member_enter_your_real_name')}" id="user" name="username"/>
        </div>
        <div class="div-item">
            <span>卡号</span>
            <input id="cid" type="text" name="cid" placeholder="请输入卡号"/>
        </div>
        <div class="div-item">
            <span>失效日期</span>
            <select  name="month" id="month">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
            </select>/<select name="year" id="year">
                <option value="2019">2019</option>
                <option value="2020">2020</option>
                <option value="2021">2021</option>
                <option value="2022">2022</option>
                <option value="2023">2023</option>
                <option value="2024">2024</option>
                <option value="2025">2025</option>
            </select>
        </div>
        <div class="div-item">
            <span>安全码</span>
            <input id="code" type="text" name="pwd" maxlength="4"/>
        </div>
        <button type="submit" class="btn-save">提交</button>
    </form>
<script src="__TEMP__/{$style}/public/js/jquery.js"></script>
<script type="text/javascript" src="__TEMP__/{$style}/public/js/layer.js"></script>
<script type="text/javascript">
    function checkForm() {
        var card_id = document.querySelector("#cid").value;
        let date = new Date();
        let month = document.querySelector("#month").value;
        let year = document.querySelector("#year").value;
        let current_month = date.getMonth()+1;
        let current_year = date.getFullYear();
        if (document.querySelector("#user").value == '') {
            layer.msg("持卡人姓名不能为空", {
                time: 2000,
                icon: 2
            });
            return false;
        }
        if (card_id == '') {
            layer.msg("卡号不能为空", {
                time: 2000,
                icon: 2
            });
            return false;
        }
        if ((year < current_year) || (month < current_month && year == current_year)){
            layer.msg("请重新选择失效日期", {
                time: 2000,
                icon: 2
            });
            return false;
        }
        if (card_id != '') {
            var reg = /^[0-9]*$/;
            if(!reg.test(card_id)){
                layer.msg("卡号格式错误", {
                    time: 2000,
                    icon: 2
                });
                return false;
            }

        }
        if (document.querySelector("#code").value == '') {
            layer.msg("安全码不能为空", {
                time: 2000,
                icon: 2
            });
            return false;
        }
    }

    function isLuhn(strNum) {

        var oddSum = 0;
        var evenSum = 0;
        var isOdd = true;

        for (var i = strNum.length - 1; i >= 0; i--) {
            var cNum = strNum.charAt(i);
            var num = parseInt(cNum + "");

            //console.log("第" + i + "个" + "是" + "\t" + num + "\n");

            if (isOdd) {
                oddSum += num;
            } else {
                num = num * 2;
                if (num > 9) {
                    num = num % 10 + 1;
                }
                evenSum = evenSum + num;
            }
            isOdd = !isOdd;
        }

        return ((evenSum + oddSum) % 10 == 0);
    }

    $(document).ready(function () {
        var date = new Date();
        var month = date.getMonth()+1;
        var year = date.getFullYear();
        $("#month option:nth-child(" + month + ")").attr('selected','selected');
        $("#year option[value='"+year+"']").attr('selected','selected');
    });
</script>
</body>
</html>